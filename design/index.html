<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://luislimadev.github.io/LLDev/elemental.js"></script>
		<script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
		<style id="llDesign">
		
			*, body{
				padding: 0;
				margin: 0;
				transition: all 0.3s ease !important;
			}

			.escondido{ display: none; opacity: 0; }

			p.gerarNumeros {
				font-size: 30pt; //80pt fica metade de uma folha A4
				padding: 0px;
				text-align: center;
				margin: 60px 0px;
			}
			
			textarea{
				padding: 10px;
			}

			div#editor {
				display: grid;
				background: #777;
				padding: 20px;
			}
			
			div#saida div, div#saida section{
				box-shadow: 0px 0px 8px -4px #000;
			}

			div#saida{
				width: 100%;
				background: rgba(255,255,255,0.5);
				overflow-x: auto;
			}
			
			@keyframes focoDeLeitura{
				from{ background: blue }
			}

			div#propriedades div, div#propriedades a {
				padding: 10px;
				margin: 10px 0;
				border: 1px solid #0002;
				font-family: monospace;
				border-radius: 20px;
				box-shadow: 0 20px 10px -20px #000;
				background: rgb(255 255 255/0.25)
				/* transform: scale(0.95); */
			}

			div#topoProps{
				background: white;
				position: fixed;
				right: 40px;
			}

			div.itensFilhos a{
				background: white;
				display: block;
			}

			div#propriedades{
				transition: .5s all ease;
				min-height: 150px;
				position: fixed;
				width: 300px;
				background: #88aaff;
				top: 1%;
				right: 20px;
				height: 90vh;
				border: 15px solid #88aaff;
				overflow-y: auto;
				box-shadow: 0px 3px 6px #000;
				display: none;
				border-radius: 20px;
			}

			div#propriedades:target{
				display: block;
			}

			#exibirProps a:hover{
				background-color: #48f;
				box-shadow: 0px 3px 9px #000;
			}

			#exibirProps a.btflutante{
				transition: .5s all ease;
				text-decoration: none;
				color: white;
				position: fixed;
				top: 80%;
				right: 40px;
				background-color: #88aaff;
				padding: 20px;
				border-radius: 10px;
				box-shadow: 0px 1px 6px -4px #000;
			}
			button, input, select{
				background: rgba(255,255,255,0.75);
				border: 1px solid #fff;
				font-style: monospace;
				border-radius: 10px;
				padding: 10px;
				margin: 5px;
			}

			#propriedades::-webkit-scrollbar-thumb {
				background-color: rgb(200 200 255);
				border-radius: 12px;
				width: 53px;
			}

			#propriedades::-webkit-scrollbar-track{
				background-color: rgb(255 255 255 / 10%);
			}

			#propriedades::-webkit-scrollbar {
				width: 3px;
				height: 3px;
				background-color: transparent;
				border-radius: 0px;
			}

		</style>
	
	</head>
	<script>
		
	</script>
	<body>
	
		<div id="tudo">
		
			<div id="divMedia">

				<div id="editor">
					<div style="overflow: hidden">
						<div style="display: grid" id="ferramentas">
							<div id="menuConteudo">
								<label>Nome do arquivo: <input id="nomeDoArquivo" name="nomeDoArquivo" placeholder="index.html" value="index.html"/></label>
								<button onclick="salvarArquivo()">Baixar</button>
								<button onclick="ajustTamanhos()">Ajustar</button>
							</div>
							<div id="itensPrincipais">
								<textarea id="entrada" rows="7" ></textarea>
								<div id="saida" contenteditable="true" onmousedown="iniciaHold()" onmouseup="finalHold()"></div>
							</div>
						</div>
					</div>
					<div id="exibirProps">
						<a href="javascript:abrirJanela( getById('propriedades') )" class="btflutante">Propriedades +</a>
						<div id="propriedades" class="escondido">Props<a href="javascript:fecharJanela( getById('propriedades') )" class="btflutante">Fechar</a></div>
					</div>
				</div>
			</div>
		
		</div>
	
	</body>
	<script>
	
		elmnts = new Elementos;
		forms = new FormLL;
		posItens = "block";
		larguraTotal = window.innerWidth || screen.availWidth;
		alturaTotal = window.innerHeight || screen.availHeight;
		getById("entrada").style.width = "100%";
		getById("entrada").style.height = ( Math.round(alturaTotal*0.40) ) + "px";
		getById("saida").style.width = "100%";
		getById("saida").style.height = ( Math.round(alturaTotal*0.48) ) + "px";

		ajustTamanhos=()=>{
			larguraTotal = window.innerWidth || screen.availWidth;
			alturaTotal = window.innerHeight || screen.availHeight;
			if( posItens === "block"){
				getById("itensPrincipais").style.display = "block";
				getById("entrada").style.width = ( Math.round( larguraTotal * 0.96) ) + "px";
				getById("entrada").style.height = ( Math.round(alturaTotal * 0.40) ) + "px";
				getById("saida").style.width = ( Math.round( larguraTotal * 0.96) ) + "px";
				getById("saida").style.height = ( Math.round(alturaTotal*0.48) ) + "px";
				posItens = "flex";
			} else {
				posItens = "block";
				getById("itensPrincipais").style.display = "flex";
				getById("entrada").style.width = ( Math.round( larguraTotal * 0.48) ) + "px";
				getById("entrada").style.height = ( Math.round(alturaTotal*0.84) ) + "px";
				getById("saida").style.width = ( Math.round( larguraTotal * 0.48) ) + "px";
				getById("saida").style.height = ( Math.round(alturaTotal*0.86) ) + "px";
			}
		}

		function salvarArquivo(){
			textoConteudo = getById("entrada").value;
			nomeDoArquivo = getById("nomeDoArquivo").value;
			download( nomeDoArquivo, textoConteudo );
		}

		const gerarNumeros = ( numeroInicial, numeroFinal, pularNumeros ) => {
			if ( pularNumeros == null ){ pularNumeros = 2 }
			while ( numeroInicial <= numeroFinal ){
				paragrafo =  elmnts.novoParagrafo( "De '" + numeroInicial + "' \r\n até '" + ( ( numeroInicial + pularNumeros ) - 1) + "'");
				paragrafo.setAttribute("class", "gerarNumeros");
				elmnts.acrescentar("saida", paragrafo );
				numeroInicial = numeroInicial + pularNumeros;
			}
		}

		function testeCores(){
			nada = 0; total = 255;
			while (nada <= total){
				codigoDaCor = "rgb(0,"+nada+",125)";
				mostragem = novoElm("div");
				mostragem.style.background = codigoDaCor ;
				getById("saida").append( mostragem );
				mostragem.innerText = codigoDaCor;
				nada = nada + 01;
			}
		}

		function playM( urlMusica, tipoDeAudio, elementoDeSaida ){
			tagAudio = novoElm("audio");
			tagAudio.setAttribute("controls", "");
			elmnts.acrescentar( tagAudio, tagSource( urlMusica, "audio/" + tipoDeAudio ) );
			getById( elementoDeSaida ).append( tagAudio );
		}

		function playV( urlVideo, tipoDeVideo, elementoDeSaida ){
			tagVideo = novoElm("video");
			tagVideo.setAttribute("controls", "");
			tagVideo.append( tagSource( urlVideo, "video/" + tipoDeVideo ) );
			getById( elementoDeSaida ).append( tagVideo );
		}

		function tagSource( urlDoItem, tipoDoItem ){
			origemDoItem = novoElm("source");
			origemDoItem.src = urlDoItem;
			origemDoItem.setAttribute( "type", tipoDoItem );
			return origemDoItem;
		}

		function testeRGB( vermelho, verde, azul){
			nada = 0; total = 255;
			while (nada <= total){
				codigoDaCor = "rgb(0,"+nada+",125)";
				mostragem = novoElm("div");
				mostragem.style.background = codigoDaCor ;
				getById("saida").append(mostragem);
				mostragem.innerText = codigoDaCor;
				nada = nada + 01;
			}
		}

		function addLinkNoPost( textoDeLink ){
			//getById("entrada").value = getById("entrada").value + elmnts.novoLink( textoDeLink, getById( "campo1" ).value , getById("campo2").value ).outerHTML;
			
			//tamanhoDoTexto = textoDeLink.length;
			//getById("entrada").value.match( window.document.getSelection().toLocaleString() );
			console.log(getById("entrada").value.replace( window.document.getSelection().toLocaleString(), elmnts.novoLink( textoDeLink, getById( "campo1" ).value , getById("campo2").value ).outerHTML ));
			getById("entrada").value = getById("entrada").value.replace( window.document.getSelection().toLocaleString(), " " + elmnts.novoLink( textoDeLink, getById( "campo1" ).value , getById("campo2").value ).outerHTML + " " );
			getById("campo1").value = "";
			getById("campo2").value = "";
			gerarHTML();
		}

		function gerarHTML(){
			getById("saida").innerHTML = getById("entrada").value;
		}
		
		function addLink(){
			selecao = window.document.getSelection();
			textoDoLink = window.document.getSelection().toLocaleString();
			if( textoDoLink != "" && textoDoLink != null && window.document.getSelection().anchorNode.id === "ferramentas" ){
				//getById("campo1").class.remove( "escondido" );
				//getById("campo2").class.remove( "escondido" );
				getById("atributos").style.animation = "1s focoDeLeitura linear normal";
				getById("campo1").placeholder = "endereço Do Link";
				getById("campo2").placeholder = "abrir em nova guia?";
				getById("adicionarItem").addEventListener( "click", function(){addLinkNoPost( textoDoLink ) });
			}
		}

		function abrirJanela( janelaParaAbrir ){ janelaParaAbrir.style.display = "block"; setTimeout( function(){ janelaParaAbrir.style.opacity = "1" }, 500) }
		function fecharJanela( janelaParaFechar ){ janelaParaFechar.style.opacity = "0" ; setTimeout( function(){ janelaParaFechar.style.display = "none" }, 500) }

		function novoElementoAleatorio( nomeElemento, attr1, valor1, attr2, valor2, valorInterno){
			novoElemento = document.createElement( nomeElemento );
			novoElemento.setAttribute( attr1, valor1 );
			novoElemento.setAttribute( attr2, valor2 );
			if( valorInterno != "" && valorInterno != null ){
				novoElemento.innerHTML = valorInterno;
			}
			return novoElemento;
		}

		function elementoPai( elementofilho ){
			itemSelecionadoEdicao = elementofilho.parentElement;
			listarAttrs( itemSelecionadoEdicao );
		}

		function aplicarPropriedade( propNome, valorProp ){
			itemSelecionadoEdicao.setAttribute(propNome, valorProp);
			gerarTexto();
		}

		function listarAttrs( elSelecionado ){
			itemSelecionadoEdicao = elSelecionado;
			nomeElemento = forms.inputTexto( "nomeElemento", "nomeElemento",'');
			nomeElemento.placeholder = "nome do elemento";
			nomeAttr1 = forms.inputTexto( "nomeAttr1", "nomeAttr1",'class');
			nomeAttr1.placeholder = "primeiro atributo";
			valAttr1 = forms.inputTexto( "valAttr1", "valAttr1",'');
			valAttr1.placeholder = "valor do primeiro atributo";
			nomeAttr2 = forms.inputTexto( "nomeAttr2", "nomeAttr2",'style');
			nomeAttr2.placeholder = "segundo atributo";
			valAttr2 = forms.inputTexto( "valAttr2", "valAttr2",'');
			valAttr2.placeholder = "valor do segundo atributo";
			valInternoElm = forms.inputTexto( "valInternoElm", "valInternoElm",'');
			valInternoElm.placeholder = "conteudo do elemento";

			quantidadeDeAttrs = elSelecionado.attributes.length;
			btflutanteFechar = elmnts.novoLink("Propriedades -", "javascript:fecharJanela( getById('propriedades') )");
			btflutanteFechar.setAttribute( "class", "btflutante" );
			topoProps = elmnts.novaDiv( btflutanteFechar.outerHTML ) ;
			topoProps.style.position = "fixed";
			topoProps.id = "topoProps";
			getById("propriedades").innerHTML = elmnts.novoButton("Ajustar",'ajustTamanhos()',"").outerHTML +"<hr>"+ btflutanteFechar.outerHTML + "<h3>Objeto: " + elSelecionado.tagName + "</h3><h3>ID: " + elSelecionado.id + "</h3><h4>Class: " + elSelecionado.className + "</h4>";

			//itensFilhos = elmnts.novaDiv(elmnts.novoButton('Acima', "elementoPai( itemSelecionadoEdicao )" ,'').outerHTML + "<h3>Árvore</h3>");
			itensFilhos = elmnts.novaDiv(elmnts.novoLink('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100" height="20"><polygon points="0,10, 10,0, 0,10, 20,10, 0,10, 10,20" style="stroke:black"></polygon><text style="transform: translate(30px, 19px); font-size: 18pt;">Acima</text></svg>', "javascript:elementoPai( itemSelecionadoEdicao )" ,'').outerHTML + "<h3>Árvore</h3>");
			itensFilhos.setAttribute("class", "itensFilhos");
			getById("propriedades").append( itensFilhos );
			if( itemSelecionadoEdicao.children.length > 0){
				elFilhos=0;
				while( elFilhos < itemSelecionadoEdicao.children.length ){
					itensFilhos.append( elmnts.novoLink( ( elFilhos + 1) + ". " + itemSelecionadoEdicao.children[elFilhos].nodeName + ": " + itemSelecionadoEdicao.children[elFilhos].innerHTML.slice(0,20) , "javascript:listarAttrs( itemSelecionadoEdicao.children[" + elFilhos + "] )", "") );
					elFilhos++;
				}
			}

			if( itemSelecionadoEdicao.nodeName == "STYLE" || itemSelecionadoEdicao.nodeName == "SCRIPT"){
				getById("propriedades").append( elmnts.novaDiv( "<h3>" + itemSelecionadoEdicao.nodeName + "</h3>" + elmnts.novaDiv( itemSelecionadoEdicao.innerHTML.replaceAll(";", "; <br>") ).outerHTML ) )
				//console.log( itemSelecionadoEdicao.nodeName );
			}

			btNovoElemento = elmnts.novaDiv("Adicionar um novo Elemento: ");
			getById("propriedades").append( btNovoElemento );
			btNovoElemento.append( nomeElemento, nomeAttr1, valAttr1, nomeAttr2, valAttr2, valInternoElm );
			btNovoElemento.append( elmnts.novoButton("Add", 'itemSelecionadoEdicao.append( novoElementoAleatorio( getById( "nomeElemento" ).value, getById( "nomeAttr1" ).value, getById( "valAttr1" ).value, getById( "nomeAttr2" ).value, getById( "valAttr2" ).value, getById( "valInternoElm" ).value ) )', '' ) );

			contAttrs = 0;
			while(contAttrs < quantidadeDeAttrs ){
				attrNome = elSelecionado.attributes[ contAttrs ].name;
				if( attrNome == "style"){
					conteudoAtributo = elSelecionado.attributes[ contAttrs ].textContent.replaceAll(";", "; <br>");
					//conteudoAtributo = itemSelecionadoEdicao.style.cssText.replaceAll(";", "; <br>");
				} else {
					conteudoAtributo = elSelecionado.attributes[ contAttrs ].textContent;
				}
				//console.log( conteudoAtributo );
				editarAttrs = elmnts.novaDiv( conteudoAtributo );
				editarAttrs.id = "editarAttr--" + attrNome;
				editarAttrs.setAttribute("contenteditable", "true");
				getById("propriedades").append( elmnts.novaDiv( "<h5>" + elSelecionado.attributes[ contAttrs ].name + "</h5>" + editarAttrs.outerHTML + elmnts.novoButton("Aplicar " + attrNome, 'aplicarPropriedade( "' + attrNome + '", getById("editarAttr--' + attrNome + '").innerText )', "").outerHTML ) );
				contAttrs++;
			}
			novoAttrNome = elmnts.novaDiv("add_atributo");
			novoAttrNome.setAttribute("contenteditable", "true");
			novoAttrValor = elmnts.novaDiv("valores");
			novoAttrValor.setAttribute("contenteditable", "true");
			btAplicaNovoAttr = elmnts.novoButton("Adicionar", "itemSelecionadoEdicao.setAttribute( novoAttrNome.innerText, novoAttrValor.innerText )", "");
			getById("propriedades").append( novoAttrNome, novoAttrValor, btAplicaNovoAttr );
		}

		function gerarTexto(){
			getById("entrada").value = getById("saida").innerHTML;
		}
		
		getById("saida").addEventListener( "change", function(){
			gerarTexto();
		});
		
		getById("saida").addEventListener( "keyup", function(){
			getById("entrada").value = getById("saida").innerHTML;
		});
		
		getById("entrada").addEventListener( "keyup", function(){
			gerarHTML();
		});
		let itemSelecionadoEdicao;
		document.getElementById("saida").addEventListener('click', function(e) {
			itemSelecionadoEdicao = e.target;
			listarAttrs( e.target );
		});

		iniciaHold=()=>{
			llT = new Date();
			segurando = "solto";
			tHold = 0;
			while( segurando === "segurando" ){
				llT.setMilliseconds(tHold);
				tHold++;
			}
		}

		finalHold=()=>{ segurando = "solto"}


	</script>
</html>
