<!DOCTYPE html>
<html>
	<head>
		<title>Editor de Página</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://luislimadev.github.io/LLDev/elemental.js"></script>
		<script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
		<style>
		
			*, body{
				padding: 0;
				margin: 0;
			}

			p.gerarNumeros {
				font-size: 30pt; //80pt fica metade de uma folha A4
				padding: 0px;
				text-align: center;
				margin: 60px 0px;
			}
			
			textarea{
				padding: 10px;
			}

			div#editor {
				display: grid;
				background: #777;
				padding: 20px;
			}
			
			div#saida div, div#saida section{
				box-shadow: 0px 0px 8px -4px #000;
			}

			div#saida{
				width: 100%;
				background: rgba(255,255,255,0.5);
			}
			
			@keyframes focoDeLeitura{
				from{ background: blue }
			}

			div#propriedades div, div#propriedades a{
				padding: 1%;
				margin: 1%;
				box-shadow: 0 0 5px -3px #000;
				font-family: monospace;
			}

			div#topoProps{
				background: white;
				position: fixed;
				right: 40px;
			}

			div.itensFilhos a{
				background: white;
				display: block;
			}

			div#propriedades{
				transition: .5s all ease;
				min-height: 150px;
				position: fixed;
				width: 300px;
				background: #88aaff;
				top: 0;
				right: 20px;
				height: 90vh;
				border: 15px solid #88aaff;
				overflow-y: auto;
				box-shadow: 0px 3px 6px #000;
				display: none;
			}

			div#propriedades:target{
				display: block;
			}

			#exibirProps a:hover{
				background-color: #48f;
				box-shadow: 0px 3px 9px #000;
			}

			#exibirProps a.btflutante{
				transition: .5s all ease;
				text-decoration: none;
				color: white;
				position: fixed;
				top: 80%;
				right: 40px;
				background-color: #88aaff;
				padding: 20px;
				border-radius: 10px;
				box-shadow: 0px 1px 6px -4px #000;
			}
			button, input, select{
				background: rgba(255,255,255,0.75);
				border: 1px solid #fff;
				font-style: monospace;
				border-radius: 10px;
				padding: 10px;
				margin: 5px;
			}

		</style>
	
	</head>
	<script>
		
	</script>
	<body>
	
		<div id="tudo">
		
			<div id="divMedia">

				<div id="editor">
					<div style="display: grid" id="ferramentas">
						<textarea id="entrada" rows="7" ></textarea>
					</div>
					<div id="saida" contenteditable="true"></div>
					<div id="exibirProps">
						<a href="javascript:abrirJanela( getById('propriedades') )" class="btflutante">Propriedades +</a>
						<div id="propriedades"><a href="javascript:fecharJanela( getById('propriedades') )" class="btflutante">Fechar</a></div>
					</div>
				</div>
			</div>
		
		</div>
	
	</body>
	<script>
	
		elmnts = new Elementos;
		forms = new FormLL;

		const gerarNumeros = ( numeroInicial, numeroFinal, pularNumeros ) => {
			if ( pularNumeros == null ){ pularNumeros = 2 }
			while ( numeroInicial <= numeroFinal ){
				paragrafo =  elmnts.novoParagrafo( "De '" + numeroInicial + "' \r\n até '" + ( ( numeroInicial + pularNumeros ) - 1) + "'");
				paragrafo.setAttribute("class", "gerarNumeros");
				elmnts.acrescentar("saida", paragrafo );
				numeroInicial = numeroInicial + pularNumeros;
			}
		}

		function testeCores(){
			nada = 0; total = 255;
			while (nada <= total){
				codigoDaCor = "rgb(0,"+nada+",125)";
				mostragem = novoElm("div");
				mostragem.style.background = codigoDaCor ;
				getById("saida").append( mostragem );
				mostragem.innerText = codigoDaCor;
				nada = nada + 01;
			}
		}

		function playM( urlMusica, tipoDeAudio, elementoDeSaida ){
			tagAudio = novoElm("audio");
			tagAudio.setAttribute("controls", "");
			elmnts.acrescentar( tagAudio, tagSource( urlMusica, "audio/" + tipoDeAudio ) );
			getById( elementoDeSaida ).append( tagAudio );
		}

		function playV( urlVideo, tipoDeVideo, elementoDeSaida ){
			tagVideo = novoElm("video");
			tagVideo.setAttribute("controls", "");
			tagVideo.append( tagSource( urlVideo, "video/" + tipoDeVideo ) );
			getById( elementoDeSaida ).append( tagVideo );
		}

		function tagSource( urlDoItem, tipoDoItem ){
			origemDoItem = novoElm("source");
			origemDoItem.src = urlDoItem;
			origemDoItem.setAttribute( "type", tipoDoItem );
			return origemDoItem;
		}

		function testeRGB( vermelho, verde, azul){
			nada = 0; total = 255;
			while (nada <= total){
				codigoDaCor = "rgb(0,"+nada+",125)";
				mostragem = novoElm("div");
				mostragem.style.background = codigoDaCor ;
				getById("saida").append(mostragem);
				mostragem.innerText = codigoDaCor;
				nada = nada + 01;
			}
		}

		function addLinkNoPost( textoDeLink ){
			//getById("entrada").value = getById("entrada").value + elmnts.novoLink( textoDeLink, getById( "campo1" ).value , getById("campo2").value ).outerHTML;
			
			//tamanhoDoTexto = textoDeLink.length;
			//getById("entrada").value.match( window.document.getSelection().toLocaleString() );
			console.log(getById("entrada").value.replace( window.document.getSelection().toLocaleString(), elmnts.novoLink( textoDeLink, getById( "campo1" ).value , getById("campo2").value ).outerHTML ));
			getById("entrada").value = getById("entrada").value.replace( window.document.getSelection().toLocaleString(), " " + elmnts.novoLink( textoDeLink, getById( "campo1" ).value , getById("campo2").value ).outerHTML + " " );
			getById("campo1").value = "";
			getById("campo2").value = "";
			gerarHTML();
		}

		function gerarHTML(){
			getById("saida").innerHTML = getById("entrada").value;
		}
		
		function addLink(){
			selecao = window.document.getSelection();
			textoDoLink = window.document.getSelection().toLocaleString();
			if( textoDoLink != "" && textoDoLink != null && window.document.getSelection().anchorNode.id === "ferramentas" ){
				//getById("campo1").class.remove( "escondido" );
				//getById("campo2").class.remove( "escondido" );
				getById("atributos").style.animation = "1s focoDeLeitura linear normal";
				getById("campo1").placeholder = "endereço Do Link";
				getById("campo2").placeholder = "abrir em nova guia?";
				getById("adicionarItem").addEventListener( "click", function(){addLinkNoPost( textoDoLink ) });
			}
		}

		function abrirJanela( janelaParaAbrir ){ janelaParaAbrir.style.display = "block" }
		function fecharJanela( janelaParaFechar ){ janelaParaFechar.style.display = "none" }

		function novoElementoAleatorio( nomeElemento, attr1, valor1, attr2, valor2, valorInterno){
			novoElemento = document.createElement( nomeElemento );
			novoElemento.setAttribute( attr1, valor1 );
			novoElemento.setAttribute( attr2, valor2 );
			if( valorInterno != "" && valorInterno != null ){
				novoElemento.innerHTML = valorInterno;
			}
			return novoElemento;
		}

		function elementoPai( elementofilho ){
			itemSelecionadoEdicao = elementofilho.parentElement;
			listarAttrs( itemSelecionadoEdicao );
		}

		function aplicarPropriedade( propNome, valorProp ){
			itemSelecionadoEdicao.setAttribute(propNome, valorProp);
			gerarTexto();
		}

		function listarAttrs( elSelecionado ){
			itemSelecionadoEdicao = elSelecionado;
			nomeElemento = forms.inputTexto( "nomeElemento", "nomeElemento",'');
			nomeElemento.placeholder = "nome do elemento";
			nomeAttr1 = forms.inputTexto( "nomeAttr1", "nomeAttr1",'class');
			nomeAttr1.placeholder = "primeiro atributo";
			valAttr1 = forms.inputTexto( "valAttr1", "valAttr1",'');
			valAttr1.placeholder = "valor do primeiro atributo";
			nomeAttr2 = forms.inputTexto( "nomeAttr2", "nomeAttr2",'style');
			nomeAttr2.placeholder = "segundo atributo";
			valAttr2 = forms.inputTexto( "valAttr2", "valAttr2",'');
			valAttr2.placeholder = "valor do segundo atributo";
			valInternoElm = forms.inputTexto( "valInternoElm", "valInternoElm",'');
			valInternoElm.placeholder = "conteudo do elemento";

			quantidadeDeAttrs = elSelecionado.attributes.length;
			btflutanteFechar = elmnts.novoLink("Propriedades -", "javascript:fecharJanela( getById('propriedades') )");
			btflutanteFechar.setAttribute( "class", "btflutante" );
			topoProps = elmnts.novaDiv( elmnts.novoButton("Elmnt Pai", "elementoPai( itemSelecionadoEdicao )" ,'').outerHTML + btflutanteFechar.outerHTML ) ;
			topoProps.style.position = "fixed";
			topoProps.id = "topoProps";
			getById("propriedades").innerHTML = topoProps.outerHTML + "<h3>Objeto: " + elSelecionado.tagName + "</h3><h3>ID: " + elSelecionado.id + "</h3><h4>Class: " + elSelecionado.className + "</h4>";

			if( itemSelecionadoEdicao.children.length > 0){
				elFilhos=0;
				itensFilhos = elmnts.novaDiv("<h3>filhos</h3>");
				itensFilhos.setAttribute("class", "itensFilhos");
				while( elFilhos < itemSelecionadoEdicao.children.length ){
					itensFilhos.append( elmnts.novoLink( itemSelecionadoEdicao.children[elFilhos].nodeName + ": " + itemSelecionadoEdicao.children[elFilhos].innerHTML.slice(0,20) , "javascript:listarAttrs( itemSelecionadoEdicao.children[" + elFilhos + "] )", "") );
					elFilhos++;
				}
				getById("propriedades").append( itensFilhos );
			}

			btNovoElemento = elmnts.novaDiv("Adicionar um novo Elemento: ");
			getById("propriedades").append( btNovoElemento );
			btNovoElemento.append( nomeElemento, nomeAttr1, valAttr1, nomeAttr2, valAttr2, valInternoElm );
			btNovoElemento.append( elmnts.novoButton("Add", 'itemSelecionadoEdicao.append( novoElementoAleatorio( getById( "nomeElemento" ).value, getById( "nomeAttr1" ).value, getById( "valAttr1" ).value, getById( "nomeAttr2" ).value, getById( "valAttr2" ).value, getById( "valInternoElm" ).value ) )', '' ) );

			contAttrs = 0;
			while(contAttrs < quantidadeDeAttrs ){
				editarAttrs = elmnts.novaDiv( elSelecionado.attributes[ contAttrs ].textContent );
				attrNome = elSelecionado.attributes[ contAttrs ].name;
				editarAttrs.id = "editarAttr--" + attrNome;
				editarAttrs.setAttribute("contenteditable", "true");
				getById("propriedades").append( elmnts.novaDiv( "<h5>" + elSelecionado.attributes[ contAttrs ].name + "</h5>" + editarAttrs.outerHTML + elmnts.novoButton("Aplicar " + attrNome, 'aplicarPropriedade( "' + attrNome + '", getById("editarAttr--' + attrNome + '").innerText )', "").outerHTML ) );
				contAttrs++;
			}
			novoAttrNome = elmnts.novaDiv("add_atributo");
			novoAttrNome.setAttribute("contenteditable", "true");
			novoAttrValor = elmnts.novaDiv("valores");
			novoAttrValor.setAttribute("contenteditable", "true");
			btAplicaNovoAttr = elmnts.novoButton("Adicionar", "itemSelecionadoEdicao.setAttribute( novoAttrNome.innerText, novoAttrValor.innerText )", "");
			getById("propriedades").append( novoAttrNome, novoAttrValor, btAplicaNovoAttr );
		}

		function gerarTexto(){
			getById("entrada").value = getById("saida").innerHTML;
		}
		
		getById("saida").addEventListener( "change", function(){
			gerarTexto();
		});
		
		getById("saida").addEventListener( "keyup", function(){
			getById("entrada").value = getById("saida").innerHTML;
		});
		
		getById("entrada").addEventListener( "keyup", function(){
			gerarHTML();
		});
		let itemSelecionadoEdicao;
		document.getElementById("saida").addEventListener('click', function(e) {
			itemSelecionadoEdicao = e.target;
			listarAttrs( e.target );
		});

	</script>
</html>
